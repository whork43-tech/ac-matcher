{% extends "base.html" %}
{% block content %}
  <section class="hero">
    <div class="badge green">師傅面板</div>
    <h1 class="h1" style="margin-top:10px;">挑選案件並快速提案</h1>
    <p class="p">先從公開案件開始，點「查看」即可提案。</p>
    <div style="height:12px"></div>
    <div class="actions">
      <a class="btn green" href="/jobs">去看公開案件</a>
      <a class="btn" href="/">回首頁</a>
    </div>
  </section>

  <section class="section">
    <div class="section-head">
      <div>
        <div class="h2">可接案件</div>
        <div class="small">只顯示開放中的案件</div>
      </div>
    </div>

    <div class="section-body">
      {% if open_jobs %}
        <table class="table">
          <thead>
            <tr>
              <th>案件</th>
              <th>地區</th>
              <th>急件</th>
              <th>建立</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for j in open_jobs[:20] %}
              <tr>
                <td>
                  <div style="display:flex;align-items:center;gap:10px;">
                    <span class="badge violet">#{{ j.id }}</span>
                    <div>
                      <div style="font-weight:900;">{{ j.service_type }} · {{ j.units }} 台</div>
                      <div class="small">{{ j.ac_type or "冷氣類型未填" }}</div>
                    </div>
                  </div>
                </td>
                <td class="muted">{{ j.city }} {{ j.district }}</td>
                <td>
                  {% if j.urgent %}
                    <span class="badge red">急件</span>
                  {% else %}
                    <span class="badge green">一般</span>
                  {% endif %}
                </td>
                <td class="muted">{{ j.created_at }}</td>
                <td><a class="btn small" href="/jobs/{{ j.id }}">查看</a></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="card soft">
          <div class="h3">目前沒有可接案件</div>
          <p class="p">稍後再來看看，或請案主先建立一筆測試案件。</p>
        </div>
      {% endif %}
    </div>
  </section>

  <section class="section">
    <div class="section-head">
      <div>
        <div class="h2">我的提案</div>
        <div class="small">你送出的報價會出現在這裡</div>
      </div>
    </div>

    <div class="section-body">
      {% if my_props %}
        <table class="table">
          <thead>
            <tr>
              <th>案件</th>
              <th>報價</th>
              <th>建立</th>
            </tr>
          </thead>
          <tbody>
            {% for p in my_props %}
              <tr>
                <td><span class="badge violet">#{{ p.job_id }}</span></td>
                <td style="font-weight:900;">NT$ {{ p.price }}</td>
                <td class="muted">{{ p.created_at }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="card soft">
          <div class="h3">你尚未提案</div>
          <p class="p">到案件頁面按「查看」後即可送出提案。</p>
        </div>
      {% endif %}
    </div>
  </section>
{% endblock %}
